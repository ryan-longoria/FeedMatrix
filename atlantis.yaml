version: 3

workflows:
  nonprod:
    plan:
      steps:
      - init:
          extra_args: ["--backend-config", "backends/nonprod-ue2-animeutopia.backend.tfvars", "--reconfigure"]
      - plan:
          extra_args: ["-var-file", "tfvars/nonprod-ue2-animeutopia.tfvars"]
    apply:
      steps:
      - apply

  prod:
    plan:
      steps:
      - init:
          extra_args: ["--backend-config", "backends/prod-ue2-animeutopia.backend.tfvars", "--reconfigure"]
      - plan:
          extra_args: ["-var-file", "tfvars/prod-ue2-animeutopia.tfvars"]
    apply:
      steps:
      - apply

projects:
- name: nonprod
  workflow: nonprod
  dir: .
  autoplan:
    enabled: true
    when_modified:
      - "./backends/*.tfvars"
      - "./tfvars/*.tfvars"
      - "*.tf"
  repo_locks:
    mode: on_plan

- name: prod
  workflow: prod
  dir: .
  autoplan:
    enabled: true
    when_modified:
      - "./backends/*.tfvars"
      - "./tfvars/*.tfvars"
      - "*.tf"
  apply_requirements: [mergeable, approved, undiverged]
  repo_locks:
    mode: on_plan
